<html>
<head>
<script type="module">
import {Doc, Event} from "./warota.mjs";

window.onload = function () {
    let timezone;
    let user1 ={id: '010203', color: '010203'};
    let user2 ={id: '020406', color : '020406'};

    let doc;
    let content;

    function resetContent() {
        content = {runs:
                   [{text: "man is much more than a tool builder."}],
                   selections: {}, timezone: 0, queue: []
                  };
        doc = new Doc();
        window.doc = doc;
        doc.load(content.runs);
    }

    function doIt(doc, edit) {
        timezone = doc.receiveEditEvents([edit], content, doc);
    }

    function case1() {
        resetContent();

        let edit1 = Event.select(user1, 1, 1, user1, content.timezone);

        let edit2 = Event.select(user2, 2, 3, user2, content.timezone);
        doIt(doc, edit1);
        doIt(doc, edit2);

        let edit3 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit3);

        let edit4 = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit4);
   }

   case1.expected = "mAaB is much more than a tool builder.";

   function case2() {
        resetContent();

        let edit1 = Event.select(user1, 1, 1, user1, content.timezone);
        doIt(doc, edit1);

        let edit2 = Event.select(user2, 2, 3, user2, content.timezone);
        doIt(doc, edit2);

        let edit3 = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit3);

        let edit4 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit4);
   }

   case2.expected = "mAaB is much more than a tool builder.";

   function case3() {
        resetContent();

        let edit1 = Event.select(user1, 1, 2, user1, content.timezone);
        doIt(doc, edit1);

        let edit2 = Event.select(user2, 2, 2, user2, content.timezone);
        doIt(doc, edit2);

        let edit3 = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit3);

        let edit4 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit4);
   }

   case3.expected = "mABn is much more than a tool builder.";

   function case4() {
        resetContent();

        let edit1 = Event.select(user1, 1, 2, user1, content.timezone);
        doIt(doc, edit1);

        let edit2 = Event.select(user2, 2, 2, user2, content.timezone);
        doIt(doc, edit2);

        let edit3 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit3);

        let edit4 = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit4);
   }

   case4.expected = "mABn is much more than a tool builder.";


//   console.log("case4:", window.doc.runs[0], window.doc.runs[0].text === );

   function case5() {
        resetContent();

        let edit1 = Event.select(user1, 1, 2, user1, content.timezone);
        let edit2 = Event.select(user2, 1, 1, user2, content.timezone);
        let edit3 = Event.insert(user1, [{text: 'A'}], content.timezone);
        let edit4 = Event.insert(user2, [{text: 'B'}], content.timezone);

        doIt(doc, edit1);
        doIt(doc, edit2);
        doIt(doc, edit3);
        doIt(doc, edit4);
   }

   case5.expected = "mABn is much more than a tool builder.";

   function case6() {
        resetContent();

        let edit1 = Event.select(user1, 1, 1, user1, content.timezone);
        doIt(doc, edit1);

        let edit2 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit2);

        let edit3 = Event.insert(user1, [{text: 'B'}], content.timezone);
        doIt(doc, edit3);
   }

   case6.expected = "mABan is much more than a tool builder.";

   function case7() {
        resetContent();

        let edit1 = Event.select(user1, 0, 0, user1, content.timezone);
        doIt(doc, edit1);

        let edit2 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit2);

   }

   case7.expected = "Aman is much more than a tool builder.";

   function case8() {
        resetContent();

        let edit1 = Event.select(user1, 1, 1, user1, content.timezone);
        doIt(doc, edit1);

        let edit2 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit2);

        let edit3 = Event.insert(user1, [{text: 'B'}], content.timezone);
        doIt(doc, edit3);

        doc.undoEvent(edit3, content, doc);

        let edit4 = Event.insert(user1, [{text: 'C'}], content.timezone);
        doIt(doc, edit4);
   }

   case8.expected = "mACan is much more than a tool builder.";

   function case9() {
        resetContent();

        let edit1 = Event.select(user1, 1, 1, user1, content.timezone);
        doIt(doc, edit1);

        let edit2 = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit2);

        let edit3 = Event.insert(user1, [{text: 'B'}], content.timezone);
        doIt(doc, edit3);

        doc.undoEvent(edit2, content, doc);

        let edit4 = Event.insert(user1, [{text: 'C'}], content.timezone);
        doIt(doc, edit4);
   }

   case9.expected = "mBCan is much more than a tool builder.";

   //let run = [case1, case2, case3, case4, case5, case6, case7, case8, case9];
   let run = [case9];
   run.forEach(r => {
     r();
     console.log(r.name + ":", window.doc.runs[0], window.doc.runs[0].text === r.expected);
   });
}
</script>

</head>
<body>
</body>
</html>
