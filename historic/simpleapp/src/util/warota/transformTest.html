<html>
<head>
<script type="module" src="doc.mjs"></script>
<script type="module">
import {Doc, Event} from './warota.mjs';

window.onload = function () {
    let sendQueue;
    let edit;

    let user1 ='010203';
    let user2 ='020406';

    let doc;
    let content;

    function resetContent() {
        content = {content: 
                   [{text: "man is much more than a tool builder."}],
                   selections: {}, timezone: 0, queue: []
                  };
        doc = new Doc();
        window.doc = doc;
        doc.load(content.content);
    }

    function doIt(doc, edit) {
        sendQueue = doc.receiveEditEvents([edit], content, doc);
        let saved = doc.save();
        content.content = saved.content;
    }

    function case1() {
        resetContent();

        edit = Event.select(user1, 1, 1, user1, content.timezone);
        doIt(doc, edit);

        edit = Event.select(user2, 2, 3, user2, content.timezone);
        doIt(doc, edit);

        content.timezone++;

        edit = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit);

        edit = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit);
   }

   case1.expected = "mAaB is much more than a tool builder.";

   function case2() {
        resetContent();

        edit = Event.select(user1, 1, 1, user1, content.timezone);
        doIt(doc, edit);

        edit = Event.select(user2, 2, 3, user2, content.timezone);
        doIt(doc, edit);

        content.timezone++;

        edit = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit);

        edit = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit);
   }

   case2.expected = "mAaB is much more than a tool builder.";

   function case3() {
        resetContent();

        edit = Event.select(user1, 1, 2, user1, content.timezone);
        doIt(doc, edit);

        edit = Event.select(user2, 2, 2, user2, content.timezone);
        doIt(doc, edit);

        content.timezone++;

        edit = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit);

        edit = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit);
   }

   case3.expected = "mABn is much more than a tool builder.";

   function case4() {
        resetContent();

        edit = Event.select(user1, 1, 2, user1, content.timezone);
        doIt(doc, edit);

        edit = Event.select(user2, 2, 2, user2, content.timezone);
        doIt(doc, edit);

        content.timezone++;

        edit = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit);

        edit = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit);
   }

   case4.expected = "mABn is much more than a tool builder.";


//   console.log("case4:", window.doc.doc[0], window.doc.doc[0].text === );

   function case5() {
        resetContent();

        edit = Event.select(user1, 1, 2, user1, content.timezone);
        doIt(doc, edit);

        edit = Event.select(user2, 1, 1, user2, content.timezone);
        doIt(doc, edit);

        content.timezone++;

        edit = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit);

        edit = Event.insert(user2, [{text: 'B'}], content.timezone);
        doIt(doc, edit);
   }

   case5.expected = "mBAn is much more than a tool builder.";

   function case6() {
        resetContent();

        edit = Event.select(user1, 1, 1, user1, content.timezone);
        doIt(doc, edit);

        content.timezone++;

        edit = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit);

        edit = Event.insert(user1, [{text: 'B'}], content.timezone);
        doIt(doc, edit);
   }

   case6.expected = "mABn is much more than a tool builder.";

   function case7() {
        resetContent();

        edit = Event.select(user1, 0, 0, user1, content.timezone);
        doIt(doc, edit);

        content.timezone++;

        edit = Event.insert(user1, [{text: 'A'}], content.timezone);
        doIt(doc, edit);

   }

   case7.expected = "Aman is much more than a tool builder.";


   //let run = [case1, case2, case3, case4, case5];
   let run = [case7];
   run.forEach(r => {
     r();
     console.log(r.name + ":", window.doc.doc[0], window.doc.doc[0].text === r.expected);
   });
}
</script>

</head>
<body>
</body>
</html>

