<!DOCTYPE html>
<html lang="en">
<head>
    
    
    
    
    <meta charset="utf-8">
    <title>Tutorial:  Writing a Croquet Model - Croquet SDK @CROQUET_VERSION@</title>
    <meta name="description" content="Documentation for the Croquet SDK" />
    
        <meta name="keywords" content="croquet" />
        <meta name="keyword" content="croquet" />
    
    <link rel="icon" type="image/png" href="images/icon.png">
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        nav img { max-width: 210px; margin-top: 10px; }
        .corner-ribbon {
            width: 200px;
            background: #f33;
            position: fixed;
            top: 25px;
            left: -50px;
            text-align: center;
            line-height: 50px;
            letter-spacing: 1px;
            color: #eee;
            box-shadow: 0 0 5px rgba(0,0,0,.5);
            transform: rotate(-45deg);
            -webkit-transform: rotate(-45deg);
        }
        .corner-ribbon.top-right {
            top: 25px;
            right: -50px;
            left: auto;
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
        }
    </style>
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    <a href="index.html"><img src="images/logotype.png"></a>
    
    <h2><a href="index.html#quickstart"><h3>QUICKSTART</h3></a></h2><h3>Globals</h3><ul><li><a href="global.html#Constants">Constants</a></li></ul><h3>Classes</h3><ul><li><a href="Model.html">Model</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Model.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="Model.html#.register">register</a></li><li data-type='method' style='display: none;'><a href="Model.html#.wellKnownModel">wellKnownModel</a></li><li data-type='method' style='display: none;'><a href="Model.html#.types">types</a></li><li data-type='method' style='display: none;'><a href="Model.html#init">init</a></li><li data-type='method' style='display: none;'><a href="Model.html#destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="Model.html#publish">publish</a></li><li data-type='method' style='display: none;'><a href="Model.html#subscribe">subscribe</a></li><li data-type='method' style='display: none;'><a href="Model.html#unsubscribe">unsubscribe</a></li><li data-type='method' style='display: none;'><a href="Model.html#unsubscribeAll">unsubscribeAll</a></li><li data-type='method' style='display: none;'><a href="Model.html#future">future</a></li><li data-type='method' style='display: none;'><a href="Model.html#random">random</a></li><li data-type='method' style='display: none;'><a href="Model.html#now">now</a></li><li data-type='method' style='display: none;'><a href="Model.html#beWellKnownAs">beWellKnownAs</a></li><li data-type='method' style='display: none;'><a href="Model.html#getModel">getModel</a></li><li data-type='method' style='display: none;'><a href="Model.html#wellKnownModel">wellKnownModel</a></li><li data-type='method' style='display: none;'><a href="Model.html#modelOnly">modelOnly</a></li></ul></li><li><a href="View.html">View</a><ul class='methods'><li data-type='method' style='display: none;'><a href="View.html#detach">detach</a></li><li data-type='method' style='display: none;'><a href="View.html#publish">publish</a></li><li data-type='method' style='display: none;'><a href="View.html#subscribe">subscribe</a></li><li data-type='method' style='display: none;'><a href="View.html#unsubscribe">unsubscribe</a></li><li data-type='method' style='display: none;'><a href="View.html#unsubscribeAll">unsubscribeAll</a></li><li data-type='method' style='display: none;'><a href="View.html#future">future</a></li><li data-type='method' style='display: none;'><a href="View.html#random">random</a></li><li data-type='method' style='display: none;'><a href="View.html#now">now</a></li><li data-type='method' style='display: none;'><a href="View.html#externalNow">externalNow</a></li><li data-type='method' style='display: none;'><a href="View.html#extrapolatedNow">extrapolatedNow</a></li><li data-type='method' style='display: none;'><a href="View.html#update">update</a></li><li data-type='method' style='display: none;'><a href="View.html#wellKnownModel">wellKnownModel</a></li></ul></li><li><a href="Session.html">Session</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Session.html#.join">join</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="global.html#event:view-join">view-join</a></li><li><a href="global.html#event:view-exit">view-exit</a></li><li><a href="global.html#event:synced">synced</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-1_1_hello_world.html"> Hello World</a></li><li><a href="tutorial-1_2_simple_animation.html"> Simple Animation</a></li><li><a href="tutorial-1_3_multiuser_chat.html"> Multiuser Chat</a></li><li><a href="tutorial-1_4_view_smoothing.html"> View Smoothing</a></li><li><a href="tutorial-1_5_3d_animation.html"> 3D Animation</a></li><li><a href="tutorial-2_1_model_view_reflector.html"> Model-View-Reflector</a></li><li><a href="tutorial-2_2_writing_a_croquet_app.html"> Writing a Croquet Application</a></li><li><a href="tutorial-2_3_writing_a_croquet_view.html"> Writing a Croquet View</a></li><li><a href="tutorial-2_4_writing_a_croquet_model.html"> Writing a Croquet Model</a></li><li><a href="tutorial-2_5_sim_time_and_future.html"> Simulation Time and Future Sends</a></li><li><a href="tutorial-2_6_events_pub_sub.html"> Events & Publish/Subscribe</a></li><li><a href="tutorial-2_7_snapshots.html"> Snapshots</a></li><li><a href="tutorial-2_8_random.html"> Randomness & Determinism</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial:  Writing a Croquet Model</h1>
    

    <section>

<header>
    
</header>

<article>
    <p>Copyright Â© 2020 Croquet Corporation</p>
<p>Unlike the view, there are limits to what the model can do if it is going to stay synched across all the machines in the session:</p>
<p><strong>Model classes must be registered when defined.</strong> Call <code>MyModel.register(&quot;MyModel&quot;)</code> every time you define a new <a href="Model.html">Model</a> subclass.</p>
<p><strong>Use <code>create</code> and <code>destroy</code> to instantiate or dispose of models.</strong> Do not use <code>new</code> to create sub-models. These models should be created/destroyed using the syntax <code>mySubModel.create()</code> and <code>mySubModel.destroy()</code>. Your <code>init</code> is called as part of the <code>create()</code> process.</p>
<p><strong>Use <code>init</code> to initialize models.</strong> Do not implement a constructor. Model classes only call <code>init</code> when they are instantiated for the first time. Put all initialization code in this method. If you put initialization code in the constructor, it would also run when the model is reloaded from a snapshot.</p>
<p><strong>No global variables.</strong> All variables in the model must be defined in the main model itself, or in sub-models instantiated by the main model. This way <em>Croquet</em> can find them and save them to the snapshot. Instead, use Croquet.Constants. The Constants object is recursively frozen once a session has started to avoid accidental modification. Here we assign the variable Q to Croquet.Constants as a shorthand.</p>
<pre class="prettyprint source"><code>const Q = Croquet.Constants;
Q.BALL_NUM = 25;              // how many balls do we want?
Q.STEP_MS = 1000 / 30;       // bouncing ball speed in virtual pixels / step
Q.SPEED = 10;                // max speed on a dimension, in units/s
</code></pre>
<p>This lets you use write <code>this.future(Q.STEP_MS).step();</code> where the STEP_MS value is registered and replicated. Just using a global STEP_MS could work in some cases, but there is no guarantee that the value will be replicated, so it could cause an accidental desyncing of the system.</p>
<p><strong>No regular classes.</strong> All objects in the model must be derived from the Model base class. (Mostly. See below for more information.)</p>
<p><strong>No outside references.</strong> The model must not use system services such as <em>Date.now()</em>, or reference JS globals such as <em>window</em>.</p>
<p><strong>No asynchronous functions.</strong> Do not use <em>Promises</em> or declare a function call with the <em>async</em> keyword inside the model.</p>
<p><strong>Do not store function references or transmit them in events.</strong> Functions cannot be serialized as part of the model state. (It's fine to use function references that exist temporarily, such as in a forEach call. You just shouldn't store them.)</p>
<p><strong>Don't query the view.</strong> Don't publish events that trigger the view to respond to the model with another event. This can create a cascade of events that clogs the system.</p>
<h2 id="advanced-topic%3A-non-model-objects-in-the-model">Advanced Topic: Non-Model Objects in the Model</h2>
<p>In general, every object in the model should be a subclass of <a href="Model.html">Model</a>. However, sometimes it's useful to be able to use the occasional non-model utility class inside your model code. This is allowed, as long as you provide <em>Croquet</em> with information about how to save and restore the non-model class.</p>
<p>Model classes that use non-model objects must include a special static method named <code>types()</code> that declares all of the non-model classes:</p>
<pre class="prettyprint source"><code>class MyModel extends Croquet.Model {
    static types() {
        return {
            &quot;MyFile.MyClass&quot;: MyClass,
        }
    }
}
</code></pre>
<p>This would use the default serializer to serialize the internals of that class. If you need to customize the serialization, add <code>write()</code> and <code>read()</code> methods that convert to and from the classes the serializer can handle (which is JSON plus built-in types like <code>Map</code>, <code>Set</code>, <code>Uint8Array</code> etc.):</p>
<pre class="prettyprint source"><code>class MyModel extends Croquet.Model {
    static types() {
        return {
            &quot;MyFile.MyClass&quot;: {
                cls: MyClass,
                write: c => ({x: c.x}),
                read: ({x}) => new MyClass(x)
            }
        }
    }
}
</code></pre>
<p>This example shows a type definition for a non-model class that stores a single piece of data, the variable x. It includes methods to extract the class data into a standard data format, and then restore a new version of the class from the stored data.</p>
</article>

</section>


    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>